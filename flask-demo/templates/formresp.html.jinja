{% extends 'form.html.jinja' %}

{% block results %}
    <script type="text/javascript" src="{{ url_for('static', filename='../js/mrs.js') }}" charset="utf-8"></script>      
    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename='../css/style.css') }}">    
    <div id="result"><br>
        <button id="sparql">Hide SPARQL</button>
        <div id="sparql-div" style="display: block;">
            {{ sparql }}
        </div><br><br>
        {# <div id="mrs-results">
            {{query_result}}
        </div> #}
        <strong style="text-align: center">{{quantMatches[0]}} matches in {{quantMatches[1]}} profile results.</strong><br>
        <strong>Showing page {{page}} of {{n_pages}}</strong> 
        <div style="float:right">
        {% if page != 1 %}
            <a href="../query?query={{wql_query}}&p={{page-1}}" class="next">&laquo;</a> 
        {% endif %}
        {% if page != n_pages %}
            <a href="../query?query={{wql_query}}&p={{page+1}}" class="next">&raquo;</a>   
        {% endif %}
        </div>
        <div id="mrsViz-results"></div>
        <div style="float:right">
        {% if page != 1 %}
            <a href="../query?query={{wql_query}}&p={{page-1}}" class="next">&laquo;</a> 
        {% endif %}
        {% if page != n_pages %}
            <a href="../query?query={{wql_query}}&p={{page+1}}" class="next">&raquo;</a>   
        {% endif %}
        </div>
    </div>

    <script type="text/javascript">
        var button = document.getElementById('sparql');
        var sparqlDiv = button.nextElementSibling;
        button.addEventListener("click", () => {
            if (sparqlDiv.style.display === "block") {
                sparqlDiv.style.display = "none";
                button.innerHTML = "Show SPARQL";
            } else {
                sparqlDiv.style.display = "block";
                button.innerHTML = "Hide SPARQL";
            }
        });
        var sparqlQuery = sparqlDiv.nextElementSibling.innerText;
        var queryBase = "SELECT ?s ?p ?o where {?s ?p ?o}"
        var matchesPage = {{matchesPage}};
        var vizCont = document.getElementById("mrsViz-results");
        for (var key in matchesPage) {
            var divViz = document.createElement('div');
            vizCont.appendChild(divViz);
            divViz.className = "mrsViz";
            divViz.innerHTML = `<hr><strong>${key}.</strong> ${matchesPage[key]['text']} <br><br>`;
            divMatch = document.createElement('div');
            divMatch.innerHTML = `Showing match 1 of ${matchesPage[key]['matches'].length}`;
            divViz.appendChild(divMatch);
            MRS(divViz, JSON.parse(matchesPage[key]['mrs']));
            
            {# // Creating the highlight:
            rels = divViz.getElementsByTagName("svg")[0]
                         .children[1]
                         .children[0]
                         .children[3].children[1] // getting the RELS g tag #}
        }
    </script>
{% endblock %}}

{#             vizCont.appendChild(divViz);
            
            divViz.className = "mrsViz";
            divViz.innerHTML = `<hr><strong>${key}.</strong> ${matchesPage[key]['text']} <br><br>`;
            
            divMatch = document.createElement('div');
            divMatch.innerHTML = `Showing match 1 of ${matchesPage[key]['matches'].length}`
            divViz.appendChild(divMatch)
            
            MRS(divViz, JSON.parse(matchesPage[key]['mrs'])); #}

